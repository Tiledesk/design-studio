/* 
  ============================================================================
  COMPONENT: cds-intent.component.scss
  ============================================================================
  
  STYLES FOR:
  - Main intent container with dynamic styling
  - Intent header and controls
  - Actions list with drag & drop
  - Action items and placeholders
  - Footer and add action button
  
  ORGANIZATION:
  1. CSS Custom Properties (CSS Variables)
  2. Host Styles
  3. Main Container Styles
  4. Header Styles
  5. Actions List Styles
  6. Action Item Styles
  7. Drag & Drop Styles
  8. Footer Styles
  9. Utility Classes
  10. Animations & Effects
  ============================================================================
*/

@import "./src/assets/sass/animations.scss";

/* ============================================================================
   CSS CUSTOM PROPERTIES
   ============================================================================ */
:host {
  --action-background: #{var(--action-item-background)};
  --action-no-featured-background: #{var(--action-no-featured-item-background)};
  --intent-background: #{var(--intent-preview-background)};
  --intent-border-color: #{var(--intent-preview-borderColor)};
  --intent-header-background: transparent;
  --base-border-radius-preview: #{var(--border-radius-base-preview)};
  --base-padding-preview: #{var(--padding-base-preview)};
  --action-selected-color: #{var(--action-color-selected)};
  --add-action-btn-background: #{var(--add-action-btn-background-preview)};
  --add-action-btn-color: #{var(--add-action-btn-color-preview)};
  --add-action-btn-hover-color: #{var(--add-action-btn-hover-color-preview)};
  --base-color: #{var(--blu)};
  --start-intent-max-width: 160px;
  --base-border-radius-base: #{var(--button-border-radius-base)};
  
  /* Optimized filter values - cached for performance */
  --filter-option-default: brightness(0) invert(99%) sepia(8%) saturate(403%) hue-rotate(225deg) brightness(117%);
  --filter-option-active: brightness(0) invert(39%) sepia(19%) saturate(1139%) hue-rotate(184deg) brightness(91%) contrast(85%);
  --filter-icon-action: brightness(0) invert(97%) sepia(66%) saturate(6656%) hue-rotate(177deg) brightness(102%) contrast(98%);
}

/* ============================================================================
   DRAG PREVIEW
   ============================================================================ */
#customDragPreview {
  display: block;
  position: absolute;
  pointer-events: none;
  user-select: none;
  opacity: 0.8;
  background-color: var(--drag-preview-background);
  max-width: 244px;
  width: 100%;
}

/* ============================================================================
   MAIN INTENT CONTAINER
   ============================================================================ */
.panel-intent-content {
  position: relative;
  width: 264px;
  margin: 0;
  padding: var(--base-padding-preview);
  border-radius: var(--base-border-radius-preview);
  cursor: grab;
  /* Optimized: Removed transition on background-color (expensive property)
     Background color changes are handled via CSS custom properties which are more performant */
  background-color: var(--intent-bg-color, transparent);
  outline: var(--intent-outline, none);

  &::before {
    content: "";
    display: block;
    position: absolute;
    border-radius: 10px;
    /* Optimized: Removed transition on box-shadow (expensive property)
       Box-shadow changes are rare and don't need smooth transitions */
  }

  /* Start Intent Variant */
  &.isStart {
    position: absolute;
    height: 100%;
    max-width: var(--start-intent-max-width);
    padding: 0;
    border: none;
    border-radius: 0;
    background-color: unset;
    outline: none;

    .intent-background-overlay {
      background-color: transparent;
      outline: none;
    }

    .header-draggable {
      width: 100%;
      height: 100%;
    }

    .pic-header {
      position: absolute;
      display: block;
      height: 100%;
      margin: 0;
      padding: 0;
    }
  }

  /* Slim Intent Variant (New Chatbot) */
  &.tds-slim-intent {
    padding: 2px;

    .pic-header {
      padding: 0;
    }

    .pic-title-text {
      padding: 4px 8px 10px;
    }

    .footer-intent {
      min-height: 0;
      margin: 0;
    }

    .tds-drop-element {
      width: calc(100% - 4px);
    }
  }

  /* Connector Overlay States */
  &.outline-border {
    outline: 2px solid var(--brown);
    border-radius: var(--base-border-radius-preview);
  }

  &.ripple-effect {
    animation-name: ripple_effect;
    animation-duration: 1s;
    animation-iteration-count: 1;
    border-radius: var(--base-border-radius-preview);
  }

  /* Live Intent States */
  &.live-active-intent-pulse {
    cursor: pointer;
    animation: pulse-blu 1s 2 forwards;
    outline: 2px solid var(--action-selected-color);
  }

  &.live-active-intent2 {
    cursor: pointer;
    /* Optimized: Removed invisible box-shadow (0 0 0 = no visual effect) */
    outline: 3px solid var(--blu);
    outline-offset: 9px;
  }

  &.live-start-intent {
    cursor: pointer;
    /* Optimized: Removed invisible box-shadow (0 0 0 = no visual effect) */
    min-height: 44px;
    border-radius: 20px;
    animation: pulse 1s infinite;
    
    /* Optimized: Pause animation when element is out of viewport */
    &.out-of-viewport {
      animation-play-state: paused;
    }
  }
}

/* ============================================================================
   INTENT BACKGROUND OVERLAY
   ============================================================================ */
.intent-background-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #fff;
  z-index: -1;
}

/* ============================================================================
   HEADER DRAGGABLE AREA
   ============================================================================ */
.header-draggable {
  position: absolute;
  width: calc(100% - 20px);
  height: 40px;
  background-color: transparent;
}

/* ============================================================================
   INTENT HEADER SECTION
   ============================================================================ */
.pic-header {
  display: flex;
  justify-content: flex-end;
  width: auto;
  margin: 0;
  padding: 0 0 10px 0;
  background-color: var(--intent-header-background);
  overflow: hidden;
  pointer-events: none;
  &.cds-start {
    /* Optimized: Replaced expensive transitions (box-shadow, background-color) with transform/opacity
       Only transition GPU-accelerated properties for better performance */
    transition: transform 0.15s ease, opacity 0.15s ease;
    position: absolute;
    /* Optimized: Inset shadow is relatively cheap, but isolate in compositing layer */
    box-shadow: #00000052 0 -1px inset;
    transform: translateZ(0);
    will-change: transform, opacity;
    background-color: #4b5052;
    border-radius: 22px;
    max-width: var(--start-intent-max-width);
    right: 0;
    cursor: pointer;
    opacity: 1;

    .cds-intent-options {
      margin-right: 30px;
    }
    }
  }

  .pic-header-title {
    border-radius: 5px;
    overflow-x: hidden;
    margin: auto 0;
  }

  .pic-title-text {
  position: relative;
  display: inline-block;
  width: 100%;
  max-width: 100%;
    padding: 4px 8px;
    border-radius: 5px;
    font-size: 15px;
    font-weight: 600;
  color: rgb(108, 104, 89);
    cursor: grab;
    box-sizing: border-box;
    white-space: pre-wrap;
    overflow-wrap: break-word;
    pointer-events: auto;
    /* Optimized: Removed transition on background (expensive property)
       Background changes are rare and don't need smooth transitions */

  &.isStart {
      height: 100%;
    display: flex;
      align-items: center;
    }

    .header {
    padding: 0;
  }
}

/* ============================================================================
   AGENTS AVAILABLE INDICATOR
   ============================================================================ */
.agents-available {
  position: absolute;
  display: block;
  margin-top: -70px;
  margin-left: -10px;

  &.isStart {
    margin-top: -25px;
    margin-left: 10px;
  }

  .material-icons {
    color: var(--intent-header-icon-color);
  }
}

/* ============================================================================
   START INTENT CONTENT
   ============================================================================ */
.cds-start-content {
  position: relative;
  display: flex;
  flex-direction: row;
  justify-content: flex-end;
  align-items: center;
  align-content: center;
  height: 100%;
  right: 11px;

  .title-label {
    display: none;
  }
}

/* ============================================================================
   INTENT OPTIONS (Question/Form Toggle)
   ============================================================================ */
.cds-intent-options {
  display: flex;
  justify-content: center;
  align-items: flex-end;
  gap: 5px;
  height: 33px;

  .option {
    display: flex;
    cursor: pointer;

    &:hover {
      opacity: 0.85;
    }

    &[active="true"] {
      img {
        /* Optimized: Simplified filter chain, removed redundant saturate(100%) */
        filter: var(--filter-option-active);
        /* Isolate in compositing layer for better performance */
        transform: translateZ(0);
        will-change: filter;
      }
    }
  }

  img {
    width: 24px;
    height: 24px;
    /* Optimized: Simplified filter chain, removed redundant saturate(100%) and contrast(100%) */
    filter: var(--filter-option-default);
    /* Isolate in compositing layer only when filter is active */
    transform: translateZ(0);
    /* Hint browser to optimize filter rendering */
    will-change: filter;
  }
}

/* ============================================================================
   ACTIONS LIST CONTAINER
   ============================================================================ */
.actions-list-wpr {
  display: flex;
  flex-direction: column;
  gap: 18px;
  padding-top: 0;

  &.cdk-drop-list-dragging .box-action:not(.cdk-drag-placeholder) {
    transition: transform 250ms cubic-bezier(0, 0, 0.2, 1);
  }
}

/* ============================================================================
   ACTION ITEM
   ============================================================================ */
.box-action {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  min-height: 30px;
  border: 2px solid rgb(255, 255, 255);
  border-radius: var(--base-border-radius-preview);
  background-color: var(--action-background);
  outline: var(--action-outline, none);

  &.isFirst {
    display: none;
  }
}

.action-element {
  width: 100%;
}

/* ============================================================================
   ACTION BODY
   ============================================================================ */
.body-action {
  position: relative;
  display: flex;
  flex-direction: column;
  width: 100%;
  border-radius: 6px;
}

.header-action {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  min-height: 25px;
  padding: 0;

  &.isLast {
    display: none;
  }
}

.cds-no-featured-action {
  background-color: rgba(255, 255, 255, 0.7);
}

/* ============================================================================
   DRAG & DROP STYLES
   ============================================================================ */
.cdk-drag-preview {
  box-sizing: border-box;
  border-radius: 4px;
  /* Optimized: Simplified from 3 shadows to 1 shadow for better performance
     Original: 3 shadows (0 5px 5px -3px, 0 8px 10px 1px, 0 3px 14px 2px)
     New: Single shadow that approximates the visual effect with less paint cost */
  box-shadow: 0 6px 12px -2px rgba(0, 0, 0, 0.25);
  /* Optimized: Isolate in compositing layer for better performance during drag */
  transform: translateZ(0);
  will-change: transform, box-shadow;
}

.cdk-drag-animating {
  transition: transform 250ms cubic-bezier(0, 0, 0.2, 1);
}

.action-drag-placeholder {
  min-height: 60px;
  border: dashed 1px var(--drop-zone-color-border);
  border-radius: 8px;
  background: var(--drop-zone-background);
  opacity: 0;
  transition: transform 250ms cubic-bezier(0, 0, 0.2, 1);
}

.cdk-drag-placeholder {
  opacity: 1;
}

.cdk-action-placeholder {
  opacity: 1;
}

.hide-drag-action-placeholder {
  display: none;
}

.tds-drop-element {
  position: absolute;
  width: calc(100% - 20px);
  height: 30px;
  z-index: 1;
  cursor: move;
}

/* ============================================================================
   ACTION ARROW
   ============================================================================ */
.cds-action-arrow {
  position: absolute;
  bottom: -15px;

  > span {
    transform: rotate(-90deg);
    color: #d2e3fc;
  }
}

/* ============================================================================
   ADD ACTION PLACEHOLDER
   ============================================================================ */
.add--action-placeholder {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  min-height: 30px;
  padding: 12px 6px;
  border: 1px dashed var(--brown);
  border-radius: 10px;
  background: rgba(221, 228, 234, 0.8);

  &:hover {
    border-color: #3ea9f5;

    .add--action-placeholder-add-icon span,
    .add--action-placeholder-text {
      color: #3ea9f5;
    }

    > .add-action-from-placeholder-btn-wpr {
      opacity: 1;
    }
  }
}

.add--action-placeholder-add-icon span {
  color: var(--brown);
  font-size: 30px;
}

.add--action-placeholder-text {
  font-weight: 400;
  color: var(--brown);
  font-size: 14px;
  text-align: center;
}

.add-action-from-placeholder-btn-wpr {
  opacity: 0;
  position: absolute;
  top: 99px;
}

/* ============================================================================
   ADD ACTION BUTTON
   ============================================================================ */
.csd-open-action-menu-btn-wpr {
  position: absolute;
  display: block;
  bottom: -41px;
  left: 0;
  right: 0;
  padding-top: 20px;
  text-align: center;
}

.footer-intent > .csd-open-action-menu-btn-wpr,
.add--action-placeholder .csd-open-action-menu-btn-wpr {
  opacity: 0;
}

.footer-intent:hover > .csd-open-action-menu-btn-wpr,
.add--action-placeholder:hover .csd-open-action-menu-btn-wpr {
  opacity: 1;
  transform: translate3d(0, 0, 0);
  /* Optimized: Replaced "all" with specific GPU-accelerated properties */
  transition: opacity 0.25s ease-in-out, transform 0.25s ease-in-out;
}

.cds-add-action-btn {
  width: 100%;
  margin: 0;
  padding: 0 10px;
  border-radius: var(--base-border-radius-base);
  background: var(--add-action-btn-background);
  /* Optimized: Single shadow is relatively cheap, but isolate in compositing layer */
  box-shadow: #001b4714 0 3px 8px;
  transform: translateZ(0);
  will-change: box-shadow, opacity;
  color: var(--add-action-btn-color);
  font-size: 0.7em;
  font-weight: 400;
  line-height: 20px;
  cursor: pointer;
  /* Optimized: Replaced "all" with specific property (opacity is GPU-accelerated) */
  transition: opacity 0.3s ease;

  &:hover {
    opacity: 0.8;
  }

  > span {
    font-size: 16px;
    color: var(--base-color);
  }
}

/* ============================================================================
   FOOTER
   ============================================================================ */
.footer-intent {
  cursor: pointer;
  min-height: 12px;
  margin-bottom: -10px;
}

.last-action-intent {
  display: block;
  float: inline-end;
  margin: 6px 0 0 0;
  padding: 0;
}

/* ============================================================================
   UTILITY CLASSES
   ============================================================================ */
.unselectable {
  -moz-user-select: -moz-none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -o-user-select: none;
  user-select: none;
}

.icon-action {
  width: 20px;
  height: 20px;
  margin-right: 6px;
  border-radius: 4px;
  align-self: start;
  color: #718497;
  opacity: 0.85;
  background: var(--brown);
  /* Optimized: Opacity is GPU-accelerated, add will-change for better performance */
  transition: opacity 0.15s ease;
  will-change: opacity;
}

.label-action {
  overflow-x: clip;
  white-space: nowrap;
  text-overflow: ellipsis;
  font-size: 14px;
}

.action-wpr {
  height: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cds-action-icon-wpr {
  display: flex;
  margin-right: 10px;

  img {
    width: 18px;
    /* Optimized: Simplified filter chain, removed redundant saturate(100%) */
    filter: var(--filter-icon-action);
    /* Isolate in compositing layer for better performance */
    transform: translateZ(0);
    /* Hint browser to optimize filter rendering */
    will-change: filter;
  }
}

.cds-action-title {
  position: absolute;
  width: 155px;
  margin-top: -57px;
  text-align: center;
  line-height: 15px;
  height: 18px;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  font-size: 10px;
  font-weight: 400;
}

/* ============================================================================
   BUTTON INTENT (Legacy - may be used by other components)
   ============================================================================ */
.button-intent {
  display: block;
  box-sizing: border-box;
  margin: 10px 5px 0;
  padding: 10px;
  border: 0.1em dashed #d2d2d2;
  border-radius: 20px;
  outline: none;
  color: #fff;
  font-size: 1em;
  font-weight: normal;
  font-family: var(--font-family-poppins);
  line-height: 32px;
  text-align: center;
    cursor: pointer;
  user-select: none;
  /* Optimized: Replaced "all" with specific properties (color is cheap, outline is acceptable) */
  transition: background-color 0.1s ease, color 0.1s ease, outline 0.1s ease;

    &:hover {
    background-color: #d2d2d2;
    color: #333333;
  }

  &.button-intent-active {
    background-color: #d2d2d2;
    color: #333333;
    outline: 2px solid rgba(236, 182, 6, 0.69);
  }
}

.intent--action {
  display: block;
  box-sizing: border-box;
  width: 96px;
  margin: 10px 5px 0;
  padding: 10px;
  border: 0.1em dashed #d2d2d2;
  border-radius: 20px;
  outline: none;
  color: #fff;
  font-size: 1em;
  font-weight: normal;
  font-family: var(--font-family-poppins);
  line-height: 32px;
  text-align: center;
  cursor: pointer;
  user-select: none;
  /* Optimized: Replaced "all" with specific properties */
  transition: background-color 0.3s ease, color 0.3s ease, border 0.3s ease;

  &.actions-btn-active {
    background-color: #fff;
    color: #333333;
    border: 1px solid #fff;
  }
}

/* ============================================================================
   ANIMATIONS & EFFECTS
   ============================================================================ */
.flashBorder {
  animation-name: flash_border;
  animation-duration: 2s;
  animation-timing-function: linear;
  animation-iteration-count: 2;
  -webkit-animation-name: flash_border;
  -webkit-animation-duration: 2s;
  -webkit-animation-timing-function: linear;
  -webkit-animation-iteration-count: 2;
  -moz-animation-name: flash_border;
  -moz-animation-duration: 2s;
  -moz-animation-timing-function: linear;
  -moz-animation-iteration-count: 2;
}

.live-active-intent {
  position: relative;
  
  /* Optimized: Isolate in compositing layer for better performance */
  transform: translateZ(0);
  will-change: transform;

  &::before {
    content: "";
    position: absolute;
    inset: -6px;
    padding: 10px;
    border-radius: 13px;
    z-index: -1;
    /* Optimized: Isolate pseudo-element in separate compositing layer */
    transform: translateZ(0);
    will-change: transform, background;
    /* Optimized: Cache gradient calculation */
    background: conic-gradient(
      from var(--outline-angle),
      var(--blu) 60%,
      rgba(255, 255, 255, 0.5) 90%,
      transparent 10%,
      var(--blu) 80%
    );
    /* Optimized: Animation can be paused when element is out of viewport */
    animation: outline-spin 3s linear infinite;
  }
  
  /* Optimized: Pause animation when element is out of viewport or not visible */
  &.out-of-viewport::before,
  &.animation-paused::before {
    animation-play-state: paused;
  }
  
  /* Optimized: Reduce animation cost when element is not in focus */
  &.reduced-motion::before {
    animation-duration: 6s; /* Slower animation = less CPU usage */
  }
}

@property --outline-angle {
  syntax: "<angle>";
  inherits: false;
  initial-value: 0turn;
}

@keyframes outline-spin {
  to {
    --outline-angle: -1turn;
  }
}

/* ============================================================================
   DEEP SELECTORS (Component Overrides)
   ============================================================================ */
cds-action-description.header-action ::ng-deep {
  .action-title {
    max-width: 100%;
  }
}

cds-panel-intent-header.isStart ::ng-deep {
  input.form-control {
    color: white;
  }
}
